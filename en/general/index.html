<!DOCTYPE html>
<html id="html-root" lang="en" dir="ltr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ec4899' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z'/%3E%3C/svg%3E">
    <title>Med-Connect - General</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { medical: { 50: '#fdf2f8', 100: '#fce7f3', 500: '#ec4899', 600: '#db2777', 700: '#be185d', 800: '#9d174d', 900: '#831843' }, gold: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' } },
                    animation: { 'bounce-drop': 'bounceDrop 0.6s cubic-bezier(0.25, 1, 0.5, 1)', 'fade-in': 'fadeIn 0.3s ease-in-out', 'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite' },
                    keyframes: { bounceDrop: { '0%': { transform: 'translateY(-500%)', opacity: '0' }, '60%': { transform: 'translateY(0)', opacity: '1' }, '75%': { transform: 'translateY(-20px)' }, '100%': { transform: 'translateY(0)' } }, fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } } }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; } 
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; } 
        .ladder-step.active { background: #ec4899; color: white; transform: scale(1.05); font-weight: 800; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border-color: white; } 
        .ladder-step.completed { opacity: 0.5; } 
        .ladder-step.safe-haven { color: #fbbf24; } 
        .ladder-step.active.safe-haven { color: white; background: #d97706; }
        .game-cell { aspect-ratio: 1/1; }
        
        /* Override Game JS Scoreboard Styles for Top Bar Layout */
        @media (min-width: 768px) {
            #scoreboard > div {
                width: auto !important;
                flex: 1 1 0% !important;
                margin-bottom: 0 !important;
                margin-right: 0.5rem !important;
            }
            #scoreboard > div:last-child {
                margin-right: 0 !important;
            }
        }

        /* Force active state colors for strategy buttons */
        .limit-btn.bg-medical-600, 
        .player-btn.bg-medical-600, 
        .grid-btn.bg-medical-600 { 
            background-color: #db2777 !important; 
            color: white !important; 
            border-color: transparent !important; 
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 h-screen overflow-hidden relative selection:bg-medical-500 selection:text-white font-sans">
    
    <!-- Ambient Background -->
    <div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
        <div class="absolute top-[-10%] left-[-10%] w-[40rem] h-[40rem] bg-pink-600/10 rounded-full blur-[100px] animate-pulse-slow"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40rem] h-[40rem] bg-purple-600/10 rounded-full blur-[100px] animate-pulse-slow" style="animation-delay: 2s;"></div>
    </div>

    <!-- Config Injection -->
    <script>
        window.gameConfig = {
            lang: 'en',
            category: 'general',
            basePath: '../../',
            availableTopics: ['riddles', 'geography']
        };
    </script>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed inset-y-0 z-[75] w-64 bg-slate-900/90 backdrop-blur-xl border-r border-slate-800 shadow-2xl transition-transform duration-300 flex flex-col left-0 transform -translate-x-full">
        <div class="px-4 pt-4">
             <button onclick="openReviewHistory()" class="w-full bg-slate-800 hover:bg-slate-700 text-slate-200 border border-slate-700 font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2 text-xs shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                <i data-lucide="history" class="w-4 h-4"></i>
                <span data-i18n="reviewHistory">Review History</span>
            </button>
        </div>
        <div class="p-4 border-b border-slate-800/50 flex justify-between items-center h-16">
            <h2 class="text-base font-bold flex items-center gap-2 text-white">
                <div class="p-1.5 bg-pink-500/20 rounded-lg"><i data-lucide="history" class="w-4 h-4 text-pink-500"></i></div>
                <span data-i18n="sessionHistory">Session History</span>
            </h2>
            <button onclick="toggleSidebar()" class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div id="history-container" class="flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar">
            <div class="text-center text-slate-500 text-xs mt-10 italic" data-i18n="noHistory">No questions answered yet.</div>
        </div>
    </aside>

    <!-- Main Content -->
    <main id="main-content" class="flex-1 flex flex-col h-full relative transition-all duration-300 z-10">
        <header class="h-16 bg-slate-900/50 backdrop-blur-md border-b border-slate-800/50 flex items-center justify-between px-4 shrink-0">
            <div class="flex items-center gap-3">
                <button onclick="toggleSidebar()" class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 transition-colors"><i data-lucide="menu" class="w-5 h-5"></i></button>
                <a href="../" class="flex items-center gap-3 hover:opacity-80 transition-opacity group">
                    <div class="bg-gradient-to-br from-pink-500 to-pink-600 text-white p-2 rounded-xl shadow-lg shadow-pink-500/20 group-hover:shadow-pink-500/40 transition-all"><i data-lucide="lightbulb" class="w-5 h-5"></i></div>
                    <div class="hidden sm:block">
                        <h1 class="font-bold text-sm leading-tight text-white">General</h1>
                        <p class="text-[10px] uppercase font-bold text-slate-500 tracking-wider">Brain Teasers & Trivia</p>
                    </div>
                </a>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="initGameSetup()" class="bg-medical-600 hover:bg-medical-500 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg shadow-medical-500/20 transition-all hover:scale-105 active:scale-95 flex items-center gap-2 border border-medical-500/50"><i data-lucide="rotate-ccw" class="w-4 h-4"></i><span class="hidden sm:inline" data-i18n="newSession">New Session</span></button>
            </div>
        </header>

        <div class="flex-1 overflow-hidden relative flex flex-col p-0 md:p-6 w-full">
            
            <!-- Strategy Mode UI -->
            <div id="strategy-ui" class="w-full h-full flex flex-col items-center justify-center hidden gap-4">
                <div id="scoreboard" class="w-full max-w-4xl flex justify-center gap-2 px-2 overflow-x-auto no-scrollbar py-2 min-h-[60px] shrink-0"></div>
                <div class="relative bg-slate-800/50 backdrop-blur-sm p-4 rounded-2xl shadow-2xl border border-slate-700/50 w-fit mx-auto flex flex-col transition-all duration-300">
                    <div class="w-full">
                        <div id="column-headers" class="grid gap-1 px-1 mb-2 w-full text-center"></div>
                        <div class="relative w-full">
                            <div id="game-grid" class="grid gap-1.5 relative z-10"></div>
                            <div id="column-selectors" class="absolute inset-0 grid gap-1.5 z-20 h-full w-full"></div>
                        </div>
                    </div>
                </div>
                <p class="text-[10px] font-bold text-slate-400 flex items-center gap-1.5 bg-slate-900/60 px-3 py-1.5 rounded-full border border-slate-800">
                    <i data-lucide="info" class="w-3 h-3 text-blue-400"></i> 
                    <span data-i18n="clickDrop">Click column to drop.</span>
                </p>
            </div>

            <!-- Solo Mode UI -->
            <div id="solo-ui" class="hidden flex-col items-center justify-center w-full max-w-md text-center gap-6 animate-fade-in p-4">
                <div class="w-20 h-20 rounded-full bg-pink-500/10 flex items-center justify-center mb-2 ring-4 ring-pink-500/20">
                    <i data-lucide="book-open" class="w-10 h-10 text-pink-500"></i>
                </div>
                <div class="space-y-1">
                    <h2 class="text-2xl font-black text-white" id="solo-mode-title" data-i18n="soloTitle">Solo Quiz</h2>
                    <p class="text-sm text-slate-400 max-w-xs mx-auto" data-i18n="soloDesc">Focus on accuracy.</p>
                </div>
                <button onclick="resumeGame()" class="hidden px-8 py-3 bg-medical-600 hover:bg-medical-500 text-white rounded-full font-bold shadow-lg shadow-medical-500/20 transition-all hover:scale-105 flex items-center gap-2 text-sm" id="resume-btn">
                    <i data-lucide="play" class="w-4 h-4 fill-current"></i> 
                    <span data-i18n="resume">Resume Quiz</span>
                </button>
            </div>

            <!-- Millionaire Mode UI -->
            <div id="millionaire-ui" class="hidden w-full h-full flex-col md:flex-row items-center justify-center gap-6 p-4 max-w-6xl mx-auto animate-fade-in">
                <div class="flex-1 flex flex-col items-center justify-center space-y-6 order-2 md:order-1 w-full">
                    <div class="bg-slate-800/50 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-slate-700/50 w-full max-w-lg text-center relative overflow-hidden">
                        <div class="absolute top-0 inset-x-0 h-1 bg-gradient-to-r from-transparent via-gold-500 to-transparent opacity-50"></div>
                        <div class="mb-4 inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-gold-500/10 text-gold-400 text-xs font-bold border border-gold-500/20">
                            <i data-lucide="award" class="w-3 h-3"></i>
                            <span data-i18n="nextPrize">Next Prize</span>
                        </div>
                        <h2 id="mil-current-prize" class="text-5xl md:text-6xl font-black text-white tracking-tight mb-2 text-shadow-lg">$100</h2>
                        <p class="text-xs text-slate-400 uppercase tracking-widest font-bold" data-i18n="currentQ">Current Question</p>
                        <button onclick="showQuestion()" id="mil-next-btn" class="mt-8 w-full py-4 bg-medical-600 hover:bg-medical-500 text-white rounded-2xl font-bold shadow-lg shadow-medical-500/20 transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2 group">
                            <span data-i18n="revealQ">Reveal Question</span>
                            <i data-lucide="arrow-right" class="w-5 h-5 transition-transform group-hover:translate-x-1"></i>
                        </button>
                    </div>
                </div>
                <div class="w-full md:w-72 bg-slate-900/80 backdrop-blur-md rounded-2xl shadow-xl border border-slate-800 overflow-hidden order-1 md:order-2 shrink-0 flex flex-col h-[300px] md:h-[600px]">
                    <div class="p-4 bg-slate-900 border-b border-slate-800 text-center">
                        <h3 class="font-bold text-xs uppercase tracking-widest text-slate-400" data-i18n="ladder">Career Ladder</h3>
                    </div>
                    <div id="money-ladder" class="flex-1 overflow-y-auto p-2 space-y-1 flex flex-col-reverse justify-end md:justify-center custom-scrollbar"></div>
                </div>
            </div>

        </div>
    </main>

    <!-- Setup Modal -->
    <div id="setup-modal" class="fixed inset-0 z-[90] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in">
        <div class="bg-slate-900 rounded-3xl shadow-2xl w-[95%] max-w-md md:max-w-2xl border border-slate-800 overflow-hidden flex flex-col max-h-[90vh]">
            <div class="bg-slate-800/50 p-6 text-center border-b border-slate-800">
                <div class="w-12 h-12 bg-medical-500/10 rounded-xl flex items-center justify-center mx-auto mb-3 text-medical-500 border border-medical-500/20 shadow-inner">
                    <i data-lucide="settings-2" class="w-6 h-6"></i>
                </div>
                <h2 class="text-2xl font-black text-white tracking-tight" data-i18n="config">Configuration</h2>
            </div>
            <div class="p-6 overflow-y-auto space-y-6 custom-scrollbar flex-1">
                
                <div class="space-y-3">
                    <label class="block text-xs md:text-sm font-bold text-slate-400 uppercase tracking-wider" data-i18n="mode">Mode</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="selectGameMode('solo')" class="mode-btn group relative p-4 rounded-2xl border-2 border-slate-800 hover:border-medical-500/50 hover:bg-slate-800 transition-all text-left flex flex-col justify-between h-full shadow-sm hover:shadow-md" data-mode="solo">
                            <div onclick="showInfo(event, 'desc_solo')" class="absolute top-1 right-1 p-1 rounded-full hover:bg-white/20 text-slate-400 hover:text-white opacity-0 group-hover:opacity-100 transition-opacity z-20 cursor-help">
                                <i data-lucide="info" class="w-3 h-3"></i>
                            </div>
                            <i data-lucide="book-open" class="w-8 h-8 text-slate-500 group-hover:text-medical-500 mb-3 transition-colors"></i>
                            <div>
                                <span class="font-bold text-sm md:text-base block text-slate-200 mb-1" data-i18n="mSolo">Solo</span>
                                <p class="text-xs text-slate-500 leading-tight" data-i18n="mQuiz">Quiz</p>
                            </div>
                        </button>
                        <button onclick="selectGameMode('strategy')" class="mode-btn group relative p-4 rounded-2xl border-2 border-slate-800 hover:border-medical-500/50 hover:bg-slate-800 transition-all text-left flex flex-col justify-between h-full shadow-sm hover:shadow-md" data-mode="strategy">
                            <div onclick="showInfo(event, 'desc_strategy')" class="absolute top-1 right-1 p-1 rounded-full hover:bg-white/20 text-slate-400 hover:text-white opacity-0 group-hover:opacity-100 transition-opacity z-20 cursor-help">
                                <i data-lucide="info" class="w-3 h-3"></i>
                            </div>
                            <i data-lucide="grid-3x3" class="w-8 h-8 text-slate-500 group-hover:text-medical-500 mb-3 transition-colors"></i>
                            <div>
                                <span class="font-bold text-sm md:text-base block text-slate-200 mb-1" data-i18n="mConnect">Connect 4</span>
                                <p class="text-xs text-slate-500 leading-tight" data-i18n="mStrategy">Strategy</p>
                            </div>
                        </button>
                        <button onclick="selectGameMode('millionaire')" class="mode-btn group relative p-4 rounded-2xl border-2 border-slate-800 hover:border-medical-500/50 hover:bg-slate-800 transition-all text-left flex flex-col justify-between h-full shadow-sm hover:shadow-md" data-mode="millionaire">
                            <div onclick="showInfo(event, 'desc_millionaire')" class="absolute top-1 right-1 p-1 rounded-full hover:bg-white/20 text-slate-400 hover:text-white opacity-0 group-hover:opacity-100 transition-opacity z-20 cursor-help">
                                <i data-lucide="info" class="w-3 h-3"></i>
                            </div>
                            <i data-lucide="dollar-sign" class="w-8 h-8 text-slate-500 group-hover:text-medical-500 mb-3 transition-colors"></i>
                            <div>
                                <span class="font-bold text-sm md:text-base block text-slate-200 mb-1" data-i18n="mResidency">Residency</span>
                                <p class="text-xs text-slate-500 leading-tight" data-i18n="mHighStakes">High Stakes</p>
                            </div>
                        </button>
                        <button onclick="selectGameMode('points')" class="mode-btn group relative p-4 rounded-2xl border-2 border-slate-800 hover:border-medical-500/50 hover:bg-slate-800 transition-all text-left flex flex-col justify-between h-full shadow-sm hover:shadow-md" data-mode="points">
                            <div onclick="showInfo(event, 'desc_points')" class="absolute top-1 right-1 p-1 rounded-full hover:bg-white/20 text-slate-400 hover:text-white opacity-0 group-hover:opacity-100 transition-opacity z-20 cursor-help">
                                <i data-lucide="info" class="w-3 h-3"></i>
                            </div>
                            <i data-lucide="trophy" class="w-8 h-8 text-slate-500 group-hover:text-medical-500 mb-3 transition-colors"></i>
                            <div>
                                <span class="font-bold text-sm md:text-base block text-slate-200 mb-1" data-i18n="mPoints">Points Battle</span>
                                <p class="text-xs text-slate-500 leading-tight" data-i18n="mCompetitive">Competitive</p>
                            </div>
                        </button>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="block text-xs md:text-sm font-bold text-slate-400 uppercase tracking-wider" data-i18n="topic">Topic</label>
                        <span id="topic-error" class="text-xs font-bold text-red-500 animate-pulse hidden" data-i18n="pickTopic">Select a Topic</span>
                    </div>
                    <div id="topic-grid" class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <!-- Dynamic buttons -->
                    </div>
                </div>

                <div id="bank-progress-container" class="hidden space-y-2 p-4 bg-slate-800/50 rounded-xl border border-slate-800">
                    <div class="flex justify-between items-center">
                        <label class="text-xs md:text-sm font-bold text-slate-400 uppercase tracking-wider" data-i18n="progress">Bank Progress</label>
                        <span id="bank-stats-text" class="text-xs md:text-sm font-bold text-medical-400">0/0</span>
                    </div>
                    <div class="h-2 w-full bg-slate-700 rounded-full overflow-hidden">
                        <div id="bank-progress-bar" class="h-full bg-medical-500 transition-all duration-500 w-0"></div>
                    </div>
                    <div class="text-right">
                        <button onclick="resetProgress()" class="text-xs text-red-400 hover:text-red-300 font-bold hover:underline transition-colors" data-i18n="resetHist">Reset History</button>
                    </div>
                </div>

                <div id="question-limit-options" class="space-y-3 hidden">
                    <label class="block text-xs md:text-sm font-bold text-slate-400 uppercase tracking-wider" data-i18n="questions">Questions</label>
                    <div class="flex gap-3">
                        <button onclick="selectQuestionLimit(10)" class="limit-btn flex-1 py-3 rounded-xl border-2 border-slate-700 hover:border-slate-600 bg-slate-800 hover:bg-slate-700 font-bold text-sm md:text-base transition-all" data-limit="10">10</button>
                        <button onclick="selectQuestionLimit(50)" class="limit-btn flex-1 py-3 rounded-xl border-2 border-slate-700 hover:border-slate-600 bg-slate-800 hover:bg-slate-700 font-bold text-sm md:text-base transition-all" data-limit="50">50</button>
                        <button onclick="selectQuestionLimit(100)" class="limit-btn flex-1 py-3 rounded-xl border-2 border-slate-700 hover:border-slate-600 bg-slate-800 hover:bg-slate-700 font-bold text-sm md:text-base transition-all" data-limit="100">100</button>
                    </div>
                </div>

                <div id="strategy-options" class="space-y-4">
                    <div class="border-t border-slate-800 pt-4">
                        <label class="block text-xs md:text-sm font-bold text-slate-400 uppercase tracking-wider mb-3" data-i18n="teams">Teams</label>
                        <div class="flex justify-between gap-3">
                            <button onclick="selectPlayerCount(2)" class="player-btn flex-1 py-3 rounded-xl border-2 border-slate-700 bg-slate-800 font-bold text-sm" data-count="2">2</button>
                            <button onclick="selectPlayerCount(3)" class="player-btn flex-1 py-3 rounded-xl border-2 border-slate-700 bg-slate-800 font-bold text-sm" data-count="3">3</button>
                            <button onclick="selectPlayerCount(4)" class="player-btn flex-1 py-3 rounded-xl border-2 border-slate-700 bg-slate-800 font-bold text-sm" data-count="4">4</button>
                            <button onclick="selectPlayerCount(5)" class="player-btn flex-1 py-3 rounded-xl border-2 border-slate-700 bg-slate-800 font-bold text-sm" data-count="5">5</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs md:text-sm font-bold text-slate-400 uppercase tracking-wider mb-3" data-i18n="gridWidth">Grid Width</label>
                        <div class="grid grid-cols-3 gap-3">
                            <button onclick="selectGridWidth(10)" class="grid-btn py-3 rounded-xl border-2 border-slate-700 bg-slate-800 font-bold text-sm" data-cols="10">Std (10)</button>
                            <button onclick="selectGridWidth(15)" class="grid-btn py-3 rounded-xl border-2 border-slate-700 bg-slate-800 font-bold text-sm" data-cols="15">Wide (15)</button>
                            <button onclick="selectGridWidth(20)" class="grid-btn py-3 rounded-xl border-2 border-slate-700 bg-slate-800 font-bold text-sm" data-cols="20">Ultra (20)</button>
                        </div>
                    </div>
                </div>

            </div>
            <div class="p-6 border-t border-slate-800 bg-slate-900">
                <button onclick="startGame()" class="w-full bg-medical-600 hover:bg-medical-500 text-white font-bold py-4 rounded-2xl shadow-lg shadow-medical-500/20 transition-all transform hover:scale-[1.02] flex items-center justify-center gap-3 text-lg">
                    <span id="start-btn-text" data-i18n="startGame">Start Game</span>
                    <i data-lucide="arrow-right" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="question-modal" class="hidden fixed inset-0 z-[100] bg-black/90 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-slate-900 rounded-2xl shadow-2xl max-w-lg w-full border border-slate-800 transform transition-all scale-95 flex flex-col max-h-[90vh] relative overflow-hidden" id="question-card">
            
            <!-- Header -->
            <div id="solo-live-stats" class="hidden bg-slate-950 p-3 border-b border-slate-800 flex justify-between items-center px-4">
                <div class="flex items-center gap-3">
                    <span class="text-sm font-black text-white font-mono" id="live-progress-text">1/10</span>
                    <div class="h-4 w-px bg-slate-700"></div>
                    <span class="text-sm font-black text-medical-400 font-mono" id="live-score-text">0</span>
                </div>
                <span class="text-sm font-black text-green-400 font-mono" id="live-accuracy-text">100%</span>
            </div>

            <!-- Tools Bar -->
            <div class="bg-slate-800/50 p-3 border-b border-slate-800 flex justify-between items-center shrink-0 relative">
                <div class="flex items-center gap-3 relative z-10">
                    <!-- Menu Button -->
                    <button onclick="toggleSidebar()" class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-400 transition-colors border border-slate-700 shadow-sm">
                        <i data-lucide="menu" class="w-4 h-4"></i>
                    </button>
                    
                    <!-- Title -->
                    <div class="flex items-center gap-2 title-container">
                        <span class="w-1.5 h-4 bg-medical-500 rounded-full"></span>
                        <span id="modal-title" class="text-[10px] font-bold uppercase tracking-widest text-slate-400">Clinical Case</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 relative z-10">
                    <button id="report-btn" onclick="reportCurrentQuestion()" title="Report Question" class="p-2 rounded-full text-slate-500 hover:text-red-400 hover:bg-red-500/10 transition-colors">
                        <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                    </button>
                    <button id="flag-btn" onclick="toggleFlagCurrentQuestion()" class="p-2 rounded-full text-slate-500 hover:text-medical-400 hover:bg-medical-500/10 transition-colors">
                        <i data-lucide="bookmark" class="w-4 h-4"></i>
                    </button>
                    <div id="q-player-badge" class="px-3 py-1 rounded-full text-[10px] font-bold bg-slate-700 text-slate-200 hidden">Player</div>
                    <button id="close-review-btn" onclick="closeReviewModal()" class="hidden p-2 rounded-full hover:bg-slate-700 text-slate-400 transition-colors">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="p-6 overflow-y-auto custom-scrollbar relative z-10">
                
                <!-- Lifelines -->
                <div id="lifelines-container" class="hidden flex gap-2 mb-6 justify-center">
                    <button onclick="useLifeline('5050')" id="lifeline-5050" class="flex-1 bg-slate-800 hover:bg-purple-900/30 text-purple-400 py-2 rounded-xl text-xs font-bold border border-purple-900/50 hover:border-purple-500/50 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span class="w-5 h-5 rounded-full bg-purple-500/20 text-purple-400 flex items-center justify-center text-[9px] border border-purple-500/30">50</span>
                        50:50
                    </button>
                    <button onclick="useLifeline('poll')" id="lifeline-poll" class="flex-1 bg-slate-800 hover:bg-blue-900/30 text-blue-400 py-2 rounded-xl text-xs font-bold border border-blue-900/50 hover:border-blue-500/50 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-lucide="bar-chart-2" class="w-4 h-4"></i> 
                        <span data-i18n="lVitals">Vitals</span>
                    </button>
                    <button onclick="useLifeline('consult')" id="lifeline-consult" class="flex-1 bg-slate-800 hover:bg-gold-900/30 text-gold-400 py-2 rounded-xl text-xs font-bold border border-gold-900/50 hover:border-gold-500/50 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-lucide="phone" class="w-4 h-4"></i> 
                        <span data-i18n="lConsult">Consult</span>
                    </button>
                </div>

                <!-- Poll Chart -->
                <div id="poll-chart" class="hidden mb-6 bg-slate-900/50 p-4 rounded-xl border border-slate-800">
                    <p class="text-[10px] text-center text-slate-500 mb-2 uppercase tracking-widest font-bold">AUDIENCE VITALS</p>
                    <div class="flex items-end justify-between h-24 gap-2 px-2" id="poll-bars"></div>
                </div>

                <!-- Question Text -->
                <h3 id="question-text" class="text-lg md:text-xl font-bold mb-6 text-white leading-relaxed font-serif"></h3>

                <!-- Options -->
                <div id="options-container" class="space-y-3"></div>

                <!-- Next Actions -->
                <div id="next-action-container" class="hidden mt-6 pt-4 border-t border-slate-800 animate-fade-in"></div>

                <!-- Finish Early -->
                <div id="finish-session-container" class="hidden mt-6 text-center">
                    <button onclick="showSoloSummary()" class="text-xs font-bold text-red-400 hover:text-red-300 hover:bg-red-500/10 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 mx-auto">
                        <i data-lucide="log-out" class="w-3 h-3 rtl:rotate-180"></i> 
                        <span data-i18n="finishEarly">Finish Early</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="review-modal" class="hidden fixed inset-0 z-[110] bg-slate-950 flex flex-col animate-fade-in">
        <div class="bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center shrink-0">
            <h2 class="text-sm font-bold flex items-center gap-2 text-white">
                <i data-lucide="history" class="w-5 h-5 text-medical-500"></i> 
                <span data-i18n="reviewHistory">Review History</span>
            </h2>
            <button onclick="closeReviewHistory()" class="p-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-slate-400 transition-colors">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        <div class="bg-slate-900 border-b border-slate-800 p-3 flex flex-col gap-3 shrink-0 z-10">
            <div class="flex p-1 bg-slate-800 rounded-xl">
                <button onclick="switchReviewTab('mistakes')" class="review-tab flex-1 py-2 rounded-lg text-xs font-bold transition-all" id="tab-mistakes" data-i18n="mistakes">Mistakes</button>
                <button onclick="switchReviewTab('flagged')" class="review-tab flex-1 py-2 rounded-lg text-xs font-bold transition-all" id="tab-flagged" data-i18n="flagged">Flagged</button>
            </div>
            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                <button onclick="filterReview('all')" class="review-filter px-4 py-1.5 rounded-full border text-[10px] font-bold whitespace-nowrap bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600" data-filter="all" data-i18n="fAll">All</button>
                <button onclick="filterReview('riddles')" class="review-filter px-4 py-1.5 rounded-full border text-[10px] font-bold whitespace-nowrap bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600" data-filter="riddles" data-i18n="tRiddles">Riddles</button>
                <button onclick="filterReview('geography')" class="review-filter px-4 py-1.5 rounded-full border text-[10px] font-bold whitespace-nowrap bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600" data-filter="geography" data-i18n="tGeography">Geography</button>
            </div>
        </div>
        <div id="review-content" class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar bg-slate-950"></div>
        <div class="p-4 bg-slate-900 border-t border-slate-800 text-center">
            <button id="clear-history-btn" class="text-xs text-red-400 hover:text-red-300 font-bold hover:underline flex items-center justify-center gap-2 mx-auto" data-i18n="clearList">
                <i data-lucide="trash-2" class="w-3 h-3"></i> Clear List
            </button>
        </div>
    </div>

    <!-- Winner Modal -->
    <div id="winner-modal" class="hidden fixed inset-0 z-[120] bg-black/95 flex items-center justify-center p-6">
        <div class="text-center animate-bounce-drop max-w-sm w-full bg-slate-900 p-8 rounded-3xl border border-slate-800 relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-medical-500/10 to-transparent opacity-50 pointer-events-none"></div>
            <div class="mb-6 relative inline-block">
                <div class="absolute inset-0 bg-gold-500 blur-3xl opacity-20 rounded-full"></div>
                <i data-lucide="trophy" class="w-20 h-20 text-gold-400 relative z-10 drop-shadow-2xl"></i>
            </div>
            <h2 id="winner-title" class="text-3xl font-black text-white mb-2 tracking-tight">VICTORY!</h2>
            <p id="winner-text" class="text-sm text-slate-400 mb-6 font-medium leading-relaxed"></p>
            <p id="winner-stats" class="text-lg text-medical-400 mb-8 font-black hidden font-mono bg-slate-800/50 py-2 rounded-lg"></p>
            <button onclick="initGameSetup()" class="w-full bg-white text-slate-900 hover:bg-slate-100 px-6 py-3.5 rounded-xl font-bold text-sm shadow-xl hover:scale-[1.02] transition-transform flex items-center justify-center gap-2">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                <span data-i18n="playAgain">Play Again</span>
            </button>
        </div>
        <canvas id="confetti" class="absolute inset-0 pointer-events-none"></canvas>
    </div>

    <!-- Script Imports -->
    <script src="../../shared.js"></script>
    <script src="../../js/data.js"></script>
    <script src="../../js/ui.js"></script>
    <script src="../../js/game.js"></script>
    <script src="../../modes/connect4.js"></script>
    <script src="../../modes/solo.js"></script>
    <script src="../../modes/millionaire.js"></script>
    <script src="../../modes/points_battle.js"></script>
    <script src="../../main.js"></script>
</body>
</html>